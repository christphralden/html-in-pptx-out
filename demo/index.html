<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>html-in-pptx-out</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['SF Mono', 'Menlo', 'Monaco', 'Consolas', 'monospace'],
          },
        },
      },
    }
  </script>
</head>
<body class="font-mono bg-white text-neutral-900 min-h-screen flex flex-col">
  <main class="flex-1 max-w-2xl mx-auto w-full px-6 py-12">
    <h1 class="text-2xl font-semibold tracking-tight mb-8">html-in-pptx-out</h1>

    <div class="mb-8">
      <div class="flex gap-6 border-b border-neutral-200 mb-6">
        <button id="tabString" class="pb-2 text-sm border-b-2 border-neutral-900">html string</button>
        <button id="tabFile" class="pb-2 text-sm border-b-2 border-transparent text-neutral-500">html file</button>
      </div>

      <div id="panelString" class="space-y-4">
        <div>
          <label class="block text-xs text-neutral-500 mb-2">input</label>
          <textarea id="htmlInput" class="w-full h-48 p-3 bg-neutral-50 border border-neutral-200 rounded text-sm resize-y focus:outline-none focus:border-neutral-400" placeholder="<body>
  <div class=&quot;slide&quot;>
    <h1>Title</h1>
  </div>
</body>"></textarea>
        </div>
      </div>

      <div id="panelFile" class="space-y-4 hidden">
        <div>
          <label class="block text-xs text-neutral-500 mb-2">file</label>
          <div class="flex items-center gap-3">
            <button id="chooseFileBtn" class="px-4 py-2 bg-neutral-900 text-white text-sm rounded">choose file</button>
            <span id="fileName" class="text-sm text-neutral-500">no file chosen</span>
            <input type="file" id="fileInput" accept=".html,.htm" class="hidden">
          </div>
        </div>
        <div id="filePreview" class="hidden">
          <label class="block text-xs text-neutral-500 mb-2">preview</label>
          <pre id="fileContent" class="w-full h-48 p-3 bg-neutral-50 border border-neutral-200 rounded text-xs overflow-auto"></pre>
        </div>
      </div>
    </div>

    <div class="mb-8">
      <label class="block text-xs text-neutral-500 mb-2">slide selector</label>
      <input type="text" id="slideSelector" value=".slide" class="w-full p-3 bg-neutral-50 border border-neutral-200 rounded text-sm focus:outline-none focus:border-neutral-400">
    </div>

    <div class="mb-8">
      <button id="convertBtn" disabled class="px-4 py-2 bg-neutral-900 text-white text-sm rounded disabled:bg-neutral-300 disabled:cursor-not-allowed">convert</button>
      <span id="status" class="ml-3 text-xs text-neutral-500"></span>
    </div>

    <div>
      <label class="block text-xs text-neutral-500 mb-2">output</label>
      <pre id="output" class="w-full min-h-32 p-3 bg-neutral-50 border border-neutral-200 rounded text-xs overflow-auto">waiting for input...</pre>
    </div>
  </main>

  <footer class="max-w-2xl mx-auto w-full px-6 py-8 border-t border-neutral-200">
    <a href="https://github.com/christphralden" target="_blank" rel="noopener" class="text-xs text-neutral-500 hover:text-neutral-900">Created by @christphralden</a>
  </footer>

  <script type="module">
    const tabString = document.getElementById('tabString');
    const tabFile = document.getElementById('tabFile');
    const panelString = document.getElementById('panelString');
    const panelFile = document.getElementById('panelFile');
    const htmlInput = document.getElementById('htmlInput');
    const chooseFileBtn = document.getElementById('chooseFileBtn');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const filePreview = document.getElementById('filePreview');
    const fileContent = document.getElementById('fileContent');
    const slideSelector = document.getElementById('slideSelector');
    const convertBtn = document.getElementById('convertBtn');
    const status = document.getElementById('status');
    const output = document.getElementById('output');

    let activeTab = 'string';
    let loadedFileContent = '';

    chooseFileBtn.addEventListener('click', () => fileInput.click());

    function updateButtonState() {
      if (activeTab === 'string') {
        convertBtn.disabled = !htmlInput.value.trim();
      } else {
        convertBtn.disabled = !loadedFileContent;
      }
    }

    function switchTab(tab) {
      activeTab = tab;
      if (tab === 'string') {
        tabString.classList.add('border-neutral-900');
        tabString.classList.remove('border-transparent', 'text-neutral-500');
        tabFile.classList.remove('border-neutral-900');
        tabFile.classList.add('border-transparent', 'text-neutral-500');
        panelString.classList.remove('hidden');
        panelFile.classList.add('hidden');
      } else {
        tabFile.classList.add('border-neutral-900');
        tabFile.classList.remove('border-transparent', 'text-neutral-500');
        tabString.classList.remove('border-neutral-900');
        tabString.classList.add('border-transparent', 'text-neutral-500');
        panelFile.classList.remove('hidden');
        panelString.classList.add('hidden');
      }
      updateButtonState();
    }

    tabString.addEventListener('click', () => switchTab('string'));
    tabFile.addEventListener('click', () => switchTab('file'));

    htmlInput.addEventListener('input', updateButtonState);

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        loadedFileContent = await file.text();
        fileName.textContent = file.name;
        fileContent.textContent = loadedFileContent;
        filePreview.classList.remove('hidden');
        status.textContent = `loaded: ${file.name}`;
        updateButtonState();
      }
    });

    convertBtn.addEventListener('click', async () => {
      const html = activeTab === 'string' ? htmlInput.value.trim() : loadedFileContent;
      if (!html) return;

      convertBtn.disabled = true;
      status.textContent = 'converting...';

      try {
        const { HtmlToPptx } = await import('../dist/index.js');

        const converter = new HtmlToPptx({
          slideSelector: slideSelector.value || '.slide'
        });

        await converter.load(html).convert();
        const dto = converter.getDTO();

        output.textContent = JSON.stringify(dto, (key, value) => {
          if (value instanceof Date) return value.toISOString();
          if (value instanceof Map) return Object.fromEntries(value);
          return value;
        }, 2);

        status.textContent = `converted: ${dto.slides.length} slide(s)`;
      } catch (err) {
        output.textContent = err.stack || err.message;
        status.textContent = 'failed';
      } finally {
        updateButtonState();
      }
    });

    updateButtonState();
  </script>
</body>
</html>
